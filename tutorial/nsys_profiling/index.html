<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/styles/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic|Source+Code+Pro:400,700" type="text/css"> <link rel=stylesheet  href="/css/font-awesome.min.css"> <link rel=stylesheet  href="/css/celeste.min.css"> <link rel=icon  type="image/png" sizes=192x192  href="/assets/favicon.png"> <link rel="shortcut icon" href="/assets/favicon.ico"> <link rel=apple-touch-icon-precomposed  sizes=152x152  href="/assets/apple-touch-icon.png"> <title>System-wide Profiling using NVIDIA Nsight Systems</title> <header> <nav class=nav-main > <ul> <a class=hvr-underline-reveal  href="/" style="margin-top: 15px; margin-right: 15px"> <img src="/assets/favicon.png" alt=Logo  style="height: 45px; width: 45px"> </a> <li class=hvr-underline-reveal ><a href="/">Home</a> <li class=hvr-underline-reveal ><a href="/doc/">Doc</a> <li class=hvr-underline-reveal ><a href="/tutorial/">Tutorial</a> <li class=hvr-underline-reveal ><a href="/blog/">Blog</a> </ul> </nav> </header> <div class=franklin-content ><h1 id=system-wide_profiling_using_nvidia_nsight_systems ><a href="#system-wide_profiling_using_nvidia_nsight_systems" class=header-anchor >System-wide Profiling using NVIDIA Nsight Systems</a></h1> <p>This tutorial aims to provide instructions on how to profile CUDA kernels using Nvidia Nsight Systems. The instructions are given based on a cloud Unix system and the VS Code platform &#40;optional&#41;.</p> <p>Basically, you can accurately measure execution time by:</p> <ol> <li><p><code>CUDA.@time</code>, a user-friendly measurement tool.</p> <li><p><code>BenchmarkTools.@benchmark</code>&#40;often used together with <code>CUDA.@sync</code> or <code>CUDA.synchronize&#40;&#41;</code>&#41;, a robust measurement tool.</p> </ol> <p>For large applications, simple time measurement is not enough. Here, we introduce Nvidia Nsight Systems for profiling CUDA kernels. This method can provide an overview of how and when the GPU was active, thereby helping identify which kernels need optimization.</p> <h2 id=prerequisite ><a href="#prerequisite" class=header-anchor >Prerequisite</a></h2> <p>Make sure to download the version of NVIDIA Nsight Systems that is compatible with your OS, hardware &#40;i.e., both CPU and GPU&#41;, and software &#40;i.e., CUDA&#41;.</p> <ul> <li><p><a href="https://developer.nvidia.com/nsight-systems/get-started">NVIDIA Nsight Systems - Get Started</a> </p> </ul> <h2 id=create_profile ><a href="#create_profile" class=header-anchor >Create Profile</a></h2> <p>Open a new bash terminal and then launch Julia with <code>nsys</code> from Night Systems:</p> <pre><code class="julia hljs">$ nsys launch julia</code></pre>
<p>Enter the package mode and activate the target Julia environment &#40;already configured with the CUDA package&#41;:</p>
<pre><code class="julia hljs">pkg&gt; activate &lt;path-to-your-project&gt;/Project.toml</code></pre>
<p>Exit the package mode and write your kernels into the Julia command line. Here we use a simple example to show how to profile:</p>
<pre><code class="julia hljs">julia&gt; <span class=hljs-keyword >using</span> CUDA
julia&gt; a = CUDA.rand(<span class=hljs-number >1024</span>, <span class=hljs-number >1024</span>, <span class=hljs-number >1024</span>)
julia&gt; sin.(a) <span class=hljs-comment ># Run it once to force compilation</span>
julia&gt; CUDA.<span class=hljs-meta >@profile</span> sin.(a)</code></pre>
<p>Then a file ending with <code>.nsys-rep</code> &#40;e.g. <code>report1.nsys-rep</code>&#41; will be created in the current directory. This file contains all the profile data.</p>
<h2 id=view_profile ><a href="#view_profile" class=header-anchor >View Profile</a></h2>
<p>Exit the Julia REPL and retrieve data from the <code>.nsys-rep</code> file.</p>
<p>There are many ways to customize the view of the profile data. Here, we simply mention three methods that can be directly displayed in your terminal.</p>
<ol>
<li><p>Display default statistics from a report</p>

</ol>
<pre><code class="julia hljs">$ nsys stats report1.nsys-rep</code></pre>
<p>This way will export an SQLite file named <code>report1.sqlite</code> from <code>report1.nsys-rep</code> &#40;assuming it does not already exist&#41;. Print the default reports in column format to the console.</p>
<ol start=2 >
<li><p>Display specific data from a report</p>

</ol>
<pre><code class="julia hljs">$ nsys stats --report cuda_gpu_trace report1.nsys-rep</code></pre>
<p>This way will export an SQLite file named <code>report1.sqlite</code> from <code>report1.nsys-rep</code> &#40;assuming it does not already exist&#41;. Print the report generated by the cuda<em>gpu</em>trace script to the console in column format.</p>
<ol start=3 >
<li><p>Generate multiple reports, in multiple formats, output multiple places from a report</p>

</ol>
<pre><code class="julia hljs">$ nsys stats --report cuda_gpu_trace --report cuda_gpu_kern_sum --report cuda_api_sum --format csv,column --output .,- report1.nsys-rep</code></pre>
<p>Export an SQLite file named <code>report1.sqlite</code> from <code>report1.nsys-rep</code> &#40;assuming it does not already exist&#41;. Generate three reports. The first, the cuda<em>gpu</em>trace report, will be output to the file <code>report1_cuda_gpu_trace.csv</code> in CSV format. The other two reports, cuda<em>gpu</em>kern<em>sum and cuda</em>api_sum, will be output to the console as columns of data.</p>
<h2 id=view_profile_optional ><a href="#view_profile_optional" class=header-anchor >View Profile &#40;Optional&#41;</a></h2>
<p>This section is for better visualizing the profile report using the VS Code extension. The VS Code platform is required.</p>
<p>From the previous section, we created <code>.sqlite</code> and <code>.csv</code> files.</p>
<p>For the <code>.sqlite</code> file, you can download the &#39;SQLite&#39; extension. Open the Command Palette and enter <code>SQLite: Open Database</code>. Then, you can explore and query the SQLite database from the <code>.sqlite</code> file.</p>
<p>For the <code>.csv</code> file, you can download the &#39;CSV to Table&#39; extension. Open the Command Palette and enter <code>Convert to table from CSV</code>. Then, you can view the CSV file in table format.</p>
<h2 id=references ><a href="#references" class=header-anchor >References  </a></h2>
<ul>
<li><p><a href="https://cuda.juliagpu.org/stable/development/profiling/">Profiling GPU Code in CUDA.jl</a>  </p>

<li><p><a href="https://docs.nvidia.com/nsight-systems/Archives/index.html">NVIDIA Nsight Systems - Documentation Archives</a>  </p>

</ul>
<div class=page-foot >
    <p>
        &copy; <a href="https://github.com/trixi-gpu" target=_blank >Trixi-GPU</a> developers. Powered by
        <a href="https://github.com/tlienart/Franklin.jl" target=_blank >Franklin.jl</a>
        and the <a href="https://julialang.org" target=_blank >Julia programming language</a>.
    </p>
</div></div>
    
    
        <script src="/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>